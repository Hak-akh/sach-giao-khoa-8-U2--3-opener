<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Quiz - Environment & Disasters</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; }
        .animate-fadeIn { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/"
  }
}
</script>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen selection:bg-teal-100 selection:text-teal-900">
    <div id="root"></div>

    <script type="text/babel" data-presets="typescript,react">
        const { useState, useEffect, useRef, useMemo } = React;

        // ==========================================
        // 1. TYPES & ENUMS
        // ==========================================
        enum QuestionType {
            ListenWrite = 'listen-write',
            Match = 'match',
            Fill = 'fill',
            MCQ = 'mcq',
            ShortAnswer = 'short-answer',
            Writing = 'writing',
            Listening = 'listening',
            SentenceScramble = 'sentence-scramble'
        }

        // ==========================================
        // 2. SERVICES (TTS)
        // ==========================================
        let selectedVoice = null;

        const getAvailableVoices = () => {
            if (!window.speechSynthesis) return [];
            return window.speechSynthesis.getVoices().filter(voice => voice.lang.startsWith('en'));
        };

        const setPreferredVoice = (voiceName) => {
            const voices = getAvailableVoices();
            const found = voices.find(v => v.name === voiceName);
            if (found) {
                selectedVoice = found;
            }
        };

        const playTTS = (text) => {
            if (!window.speechSynthesis) {
                alert("Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ ƒë·ªçc vƒÉn b·∫£n.");
                return;
            }
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = 0.9;

            if (selectedVoice) {
                utterance.voice = selectedVoice;
            } else {
                const voices = getAvailableVoices();
                const defaultVoice = voices.find(v => v.name === 'Google US English') || 
                                     voices.find(v => v.lang === 'en-US') ||
                                     voices[0];
                if (defaultVoice) utterance.voice = defaultVoice;
            }
            window.speechSynthesis.speak(utterance);
        };

        // ==========================================
        // 3. DATA (UNITS 2 & 3)
        // ==========================================
        
        // --- UNIT 3 (ENVIRONMENT) ---
        const unit3Vocab = [
            { word: 'sea', ipa: '/siÀê/', meaning: 'bi·ªÉn', example: 'The sea is becoming polluted.' },
            { word: 'rainforests', ipa: '/Ààre…™nf…ír…™sts/', meaning: 'r·ª´ng nhi·ªát ƒë·ªõi', example: 'Rainforests are disappearing.' },
            { word: 'rivers', ipa: '/Ààr…™v…ôrz/', meaning: 's√¥ng', example: 'Many rivers dry up in summer.' },
            { word: 'lakes', ipa: '/le…™ks/', meaning: 'h·ªì', example: 'The lake is full of fish.' },
            { word: 'air', ipa: '/e…ô(r)/', meaning: 'kh√¥ng kh√≠', example: 'We need fresh air to breathe.' },
            { word: 'ice caps', ipa: '/Ààa…™s k√¶ps/', meaning: 'ch·ªèm bƒÉng', example: 'Ice caps are melting due to global warming.' },
            { word: 'become polluted', ipa: '/p…ôÀàluÀêt…™d/', meaning: 'tr·ªü n√™n √¥ nhi·ªÖm', example: 'The river has become polluted.' },
            { word: 'dry up', ipa: '/dra…™  åp/', meaning: 'c·∫°n ki·ªát / kh√¥ c·∫°n', example: 'The stream might dry up soon.' },
            { word: 'disappear', ipa: '/d…™s…ôÀàp…™…ô(r)/', meaning: 'bi·∫øn m·∫•t', example: 'Many species will disappear.' },
            { word: 'melt', ipa: '/melt/', meaning: 'tan ch·∫£y', example: 'Ice melts when it is hot.' }
        ];

        const unit3Questions = [
            {
                id: `u3-vocab-write-1`,
                type: QuestionType.ListenWrite,
                title: `1. T·ª´ v·ª±ng: Nghe v√† Vi·∫øt`,
                prompt: 'Nghe t·ª´ v·ª±ng, nh√¨n phi√™n √¢m v√† g√µ l·∫°i ch√≠nh x√°c t·ª´ ƒë√≥.',
                audioText: 'rainforests',
                display: '/Ààre…™nf…ír…™sts/',
                answer: 'rainforests',
                explanation: `T·ª´ ƒë√∫ng l√† <b>"rainforests"</b>. Nghƒ©a ti·∫øng Vi·ªát: r·ª´ng nhi·ªát ƒë·ªõi.`,
            },
            {
                id: 'u3-vocab-match',
                type: QuestionType.Match,
                title: '2. T·ª´ v·ª±ng: N·ªëi t·ª´ v·ªõi nghƒ©a',
                description: 'Gh√©p t·ª´ v·ª±ng ti·∫øng Anh v·ªõi nghƒ©a ti·∫øng Vi·ªát t∆∞∆°ng ·ª©ng.',
                explanation: 'H√£y h·ªçc thu·ªôc b·∫£ng t·ª´ v·ª±ng ƒë·ªÉ l√†m t·ªët ph·∫ßn n√†y.',
                items: [
                    { id: 'A1', A: 'rainforests', B: 'r·ª´ng m∆∞a nhi·ªát ƒë·ªõi' },
                    { id: 'A2', A: 'dry up', B: 'c·∫°n kh√¥ / c·∫°n ki·ªát' },
                    { id: 'A3', A: 'melt', B: 'tan ch·∫£y' },
                    { id: 'A4', A: 'become polluted', B: 'tr·ªü n√™n √¥ nhi·ªÖm' },
                    { id: 'A5', A: 'ice caps', B: 'ch·ªèm bƒÉng' },
                    { id: 'A6', A: 'disappear', B: 'bi·∫øn m·∫•t' },
                    { id: 'A7', A: 'rivers', B: 's√¥ng' },
                ],
            },
            {
                id: 'u3-fill-blanks',
                type: QuestionType.Fill,
                title: '3. Ng·ªØ c·∫£nh: ƒêi·ªÅn v√†o ch·ªó tr·ªëng',
                explanation: 'D·ª±a v√†o c√°c c·ª•m t·ª´ collocations trong b√†i h·ªçc: "rivers dry up", "ice caps melt", "air becomes polluted".',
                options: ['environment', 'polluted', 'dry up', 'disappear', 'lakes', 'melt'],
                questions: [
                    { text: 'The air becomes __ because of smoke from cars and factories.', answer: 'polluted', explanation: 'Kh√¥ng kh√≠ tr·ªü n√™n √¥ nhi·ªÖm (polluted) do kh√≥i b·ª•i.' },
                    { text: 'In the dry season, some rivers and lakes __.', answer: 'dry up', explanation: 'V√†o m√πa kh√¥, s√¥ng h·ªì c·∫°n ki·ªát (dry up).' },
                    { text: 'Global warming makes ice caps __.', answer: 'melt', explanation: 'N√≥ng l√™n to√†n c·∫ßu l√†m ch·ªèm bƒÉng tan ch·∫£y (melt).' },
                    { text: 'If we cut down trees, rainforests will __.', answer: 'disappear', explanation: 'N·∫øu ch·∫∑t c√¢y, r·ª´ng s·∫Ω bi·∫øn m·∫•t (disappear).' },
                    { text: 'We need to protect our __.', answer: 'environment', explanation: 'Ch√∫ng ta c·∫ßn b·∫£o v·ªá m√¥i tr∆∞·ªùng (environment).' },
                ],
            },
            {
                id: 'u3-pronun-1',
                type: QuestionType.MCQ,
                title: '4. Ng·ªØ √¢m: Ch·ªçn t·ª´ c√≥ ph√°t √¢m kh√°c',
                prompt: 'Ch·ªçn t·ª´ c√≥ ph·∫ßn g·∫°ch ch√¢n ph√°t √¢m kh√°c v·ªõi c√°c t·ª´ c√≤n l·∫°i (Ph√¢n bi·ªát /a…™/ v√† /e…™/).',
                audioText: 'ice, dry, lake, die',
                options: [
                    { text: 'A. <u>i</u>ce', value: 'ice' },
                    { text: 'B. dr<u>y</u>', value: 'dry' },
                    { text: 'C. l<u>a</u>ke', value: 'lake' },
                    { text: 'D. d<u>ie</u>', value: 'die' },
                ],
                answer: 'lake',
                explanation: '<b>Ice, Dry, Die</b> ƒë·ªÅu ch·ª©a nguy√™n √¢m ƒë√¥i <b>/a…™/</b>. <br><b>Lake</b> ch·ª©a nguy√™n √¢m ƒë√¥i <b>/e…™/</b>. <br>ƒê√°p √°n l√† C.',
            },
            {
                id: 'u3-pronun-2',
                type: QuestionType.MCQ,
                title: '5. Ng·ªØ √¢m: Ch·ªçn t·ª´ c√≥ ph√°t √¢m kh√°c',
                prompt: 'Ch·ªçn t·ª´ c√≥ ph·∫ßn g·∫°ch ch√¢n ph√°t √¢m kh√°c v·ªõi c√°c t·ª´ c√≤n l·∫°i.',
                audioText: 'rain, save, environment, wild',
                options: [
                    { text: 'A. r<u>ai</u>n', value: 'rain' },
                    { text: 'B. s<u>a</u>ve', value: 'save' },
                    { text: 'C. env<u>i</u>ronment', value: 'environment' },
                    { text: 'D. w<u>ai</u>t', value: 'wait' },
                ],
                answer: 'environment',
                explanation: '<b>Rain, Save, Wait</b> ƒë·ªÅu ch·ª©a √¢m <b>/e…™/</b>. <br><b>Environment</b> ch·ª©a √¢m <b>/a…™/</b> (·ªü √¢m ti·∫øt th·ª© 2). <br>ƒê√°p √°n l√† C.',
            },
            {
                id: 'u3-conditional-1',
                type: QuestionType.ShortAnswer,
                title: '6. Ng·ªØ ph√°p: C√¢u ƒëi·ªÅu ki·ªán lo·∫°i 1',
                prompt: 'Vi·∫øt ti·∫øp v·∫ø sau c·ªßa c√¢u ƒëi·ªÅu ki·ªán (k·∫øt qu·∫£).',
                prefix: 'If ice caps melt, ...',
                placeholder: 'sea levels will rise',
                correctAnswer: 'rise',
                explanation: 'N·∫øu bƒÉng tan, m·ª±c n∆∞·ªõc bi·ªÉn s·∫Ω d√¢ng cao. <br>G·ª£i √Ω: "sea levels will rise" ho·∫∑c "the sea level will rise".',
            },
            {
                id: 'u3-scramble-1',
                type: QuestionType.SentenceScramble,
                title: '7. S·∫Øp x·∫øp c√¢u (Nghe v√† X·∫øp)',
                prompt: 'Nghe v√† s·∫Øp x·∫øp c√°c t·ª´ sau th√†nh c√¢u ho√†n ch·ªânh v·ªÅ b·∫£o v·ªá m√¥i tr∆∞·ªùng.',
                audioText: 'If we pollute the rivers fish will die',
                segments: ['the rivers,', 'If', 'fish', 'will die.', 'we pollute'],
                correctOrder: ['If', 'we pollute', 'the rivers,', 'fish', 'will die.'],
                explanation: 'C·∫•u tr√∫c c√¢u ƒëi·ªÅu ki·ªán lo·∫°i 1: <br><b>If + S + V (hi·ªán t·∫°i), S + will + V (nguy√™n th·ªÉ).</b><br>D·ªãch: N·∫øu ch√∫ng ta l√†m √¥ nhi·ªÖm c√°c d√≤ng s√¥ng, c√° s·∫Ω ch·∫øt.',
            }
        ];

        // --- UNIT 2 (DISASTERS) ---
        const unit2Vocab = [
            { word: 'tsunami', ipa: '/tsuÀêÀàn…ëÀêmi/', meaning: 's√≥ng th·∫ßn', example: 'A huge tsunami hit the coast.' },
            { word: 'earthquake', ipa: '/Àà…úÀêŒ∏kwe…™k/', meaning: 'ƒë·ªông ƒë·∫•t', example: 'The building shook during the earthquake.' },
            { word: 'landslide', ipa: '/Ààl√¶ndsla…™d/', meaning: 's·∫°t l·ªü ƒë·∫•t', example: 'Heavy rain caused a landslide.' },
            { word: 'flood', ipa: '/fl åd/', meaning: 'l≈© l·ª•t', example: 'The flood covered the town in water.' },
            { word: 'storm', ipa: '/st…îÀêm/', meaning: 'b√£o', example: 'The storm destroyed many houses.' },
            { word: 'volcanic eruption', ipa: '/v…ílÀàk√¶n…™k …™Ààr åp Én/', meaning: 'phun tr√†o n√∫i l·ª≠a', example: 'The volcanic eruption was terrifying.' },
            { word: 'explosion', ipa: '/…™kÀàspl…ô ä ín/', meaning: 'v·ª• n·ªï', example: 'We heard a loud explosion.' },
            { word: 'shipwreck', ipa: '/Àà É…™prek/', meaning: 'ƒë·∫Øm t√†u', example: 'Divers explored the shipwreck.' },
            { word: 'crash', ipa: '/kr√¶ É/', meaning: 'v·ª• va ch·∫°m (xe/m√°y bay)', example: 'There was a car crash on the road.' },
            { word: 'terrified', ipa: '/Ààter…™fa…™d/', meaning: 'khi·∫øp s·ª£', example: 'She was terrified of the storm.' },
            { word: 'relieved', ipa: '/r…™ÀàliÀêvd/', meaning: 'nh·∫π nh√µm', example: 'I felt relieved when it stopped.' },
            { word: 'worried', ipa: '/Ààw årid/', meaning: 'lo l·∫Øng', example: 'He is worried about the future.' }
        ];

        const unit2Questions = [
            {
                id: 'u2-match-disasters',
                type: QuestionType.Match,
                title: '1. Vocabulary: Label the pictures',
                description: 'N·ªëi t√™n th·∫£m h·ªça v·ªõi m√¥ t·∫£ t∆∞∆°ng ·ª©ng.',
                explanation: 'C√°c th·∫£m h·ªça thi√™n nhi√™n ch√≠nh: Earthquake (ƒê·ªông ƒë·∫•t), Tsunami (S√≥ng th·∫ßn), Flood (L≈© l·ª•t)...',
                items: [
                    { id: 'A1', A: 'tsunami', B: 'S√≥ng th·∫ßn (Huge waves)' },
                    { id: 'A2', A: 'earthquake', B: 'ƒê·ªông ƒë·∫•t (Ground shaking)' },
                    { id: 'A3', A: 'landslide', B: 'S·∫°t l·ªü ƒë·∫•t (Earth falling down)' },
                    { id: 'A4', A: 'flood', B: 'L≈© l·ª•t (Water covering land)' },
                    { id: 'A5', A: 'storm', B: 'B√£o (Strong wind and rain)' },
                    { id: 'A6', A: 'volcanic eruption', B: 'Phun tr√†o n√∫i l·ª≠a' }
                ]
            },
            {
                id: 'u2-guess-words',
                type: QuestionType.Fill,
                title: '2. Vocabulary: Guess the words',
                explanation: 'D·ª±a v√†o g·ª£i √Ω ƒë·ªÉ ƒëo√°n t·ª´ v·ª±ng v·ªÅ tai n·∫°n.',
                options: ['explosion', 'fire', 'plane crash', 'shipwreck', 'car crash'],
                questions: [
                    { text: 'A sudden loud noise ‚Üí __', answer: 'explosion', explanation: 'Ti·∫øng ·ªìn l·ªõn ƒë·ªôt ng·ªôt -> V·ª• n·ªï.' },
                    { text: 'A big accident involving burning in a building ‚Üí __', answer: 'fire', explanation: 'Tai n·∫°n li√™n quan ƒë·∫øn ch√°y -> H·ªèa ho·∫°n.' },
                    { text: 'A plane hits the ground ‚Üí __', answer: 'plane crash', explanation: 'M√°y bay ƒë√¢m xu·ªëng ƒë·∫•t -> R∆°i m√°y bay.' },
                    { text: 'A ship sinks ‚Üí __', answer: 'shipwreck', explanation: 'T√†u ch√¨m -> ƒê·∫Øm t√†u.' },
                    { text: 'A car hits another car ‚Üí __', answer: 'car crash', explanation: 'Xe h∆°i ƒë√¢m nhau -> Tai n·∫°n √¥ t√¥.' }
                ]
            },
            {
                id: 'u2-feelings',
                type: QuestionType.Fill,
                title: '3. Vocabulary: Feelings',
                explanation: 'ƒêi·ªÅn t√≠nh t·ª´ ch·ªâ c·∫£m x√∫c ph√π h·ª£p.',
                options: ['terrified', 'relieved', 'worried'],
                questions: [
                    { text: 'When the earthquake started, she was very __.', answer: 'terrified', explanation: 'Khi ƒë·ªông ƒë·∫•t x·∫£y ra -> R·∫•t s·ª£ h√£i (terrified).' },
                    { text: 'He was __ after finding out nobody was hurt.', answer: 'relieved', explanation: 'Bi·∫øt kh√¥ng ai b·ªã th∆∞∆°ng -> Nh·∫π nh√µm (relieved).' },
                    { text: 'They are __ about life after the flood.', answer: 'worried', explanation: 'V·ªÅ cu·ªôc s·ªëng sau l≈© -> Lo l·∫Øng (worried).' }
                ]
            },
            {
                id: 'u2-grammar-mcq',
                type: QuestionType.MCQ,
                title: '4. Grammar: Choose the correct answer',
                prompt: 'Ch·ªçn t·ª´ v·ª±ng ƒë√∫ng ng·ªØ c·∫£nh.',
                audioText: 'landslide, shipwreck, disaster, crash',
                options: [
                    { text: 'A. landslide', value: 'landslide' },
                    { text: 'B. shipwreck', value: 'shipwreck' },
                ],
                questionText: '1. It rained heavily before the ______ hit the town.',
                answer: 'landslide',
                explanation: 'M∆∞a l·ªõn th∆∞·ªùng g√¢y ra s·∫°t l·ªü ƒë·∫•t (landslide), kh√¥ng g√¢y ra ƒë·∫Øm t√†u tr√™n th·ªã tr·∫•n.'
            },
            {
                id: 'u2-grammar-mcq-2',
                type: QuestionType.MCQ,
                title: '4b. Grammar: Choose the correct answer',
                prompt: 'Ch·ªçn t·ª´ v·ª±ng ƒë√∫ng ng·ªØ c·∫£nh.',
                options: [
                    { text: 'A. crash', value: 'crash' },
                    { text: 'B. disaster', value: 'disaster' },
                ],
                questionText: '2. Jane saw a car ______ this morning.',
                answer: 'crash',
                explanation: 'Car crash: Tai n·∫°n xe h∆°i.'
            },
            {
                id: 'u2-grammar-mcq-3',
                type: QuestionType.MCQ,
                title: '4c. Grammar: Choose the correct answer',
                prompt: 'Ch·ªçn t·ª´ v·ª±ng ƒë√∫ng ng·ªØ c·∫£nh.',
                options: [
                    { text: 'A. eruption', value: 'eruption' },
                    { text: 'B. explosion', value: 'explosion' },
                ],
                questionText: '3. The volcanic ______ destroyed the village.',
                answer: 'eruption',
                explanation: 'Volcanic eruption: Phun tr√†o n√∫i l·ª≠a.'
            },
            {
                id: 'u2-grammar-mcq-4',
                type: QuestionType.MCQ,
                title: '4d. Grammar: Choose the correct answer',
                prompt: 'Ch·ªçn t·ª´ v·ª±ng ƒë√∫ng ng·ªØ c·∫£nh.',
                options: [
                    { text: 'A. earthquake', value: 'earthquake' },
                    { text: 'B. flood', value: 'flood' },
                ],
                questionText: '4. The ______ covered the small town in water.',
                answer: 'flood',
                explanation: 'N∆∞·ªõc bao ph·ªß th·ªã tr·∫•n -> L≈© l·ª•t (flood).'
            },
             {
                id: 'u2-grammar-mcq-5',
                type: QuestionType.MCQ,
                title: '4e. Grammar: Choose the correct answer',
                prompt: 'Ch·ªçn t·ª´ v·ª±ng ƒë√∫ng ng·ªØ c·∫£nh.',
                options: [
                    { text: 'A. terrified', value: 'terrified' },
                    { text: 'B. relieved', value: 'relieved' },
                ],
                questionText: '5. We were ______ when the building began to shake.',
                answer: 'terrified',
                explanation: 'T√≤a nh√† rung chuy·ªÉn -> S·ª£ h√£i (terrified).'
            },
            {
                id: 'u2-grammar-verbs',
                type: QuestionType.Fill,
                title: '5. Grammar: Fill in verbs',
                explanation: 'ƒêi·ªÅn ƒë·ªông t·ª´ qu√° kh·ª© ph√π h·ª£p.',
                options: ['killed', 'hit', 'destroyed', 'blew', 'overflowed'],
                questions: [
                    { text: 'The shipwreck __ three people.', answer: 'killed', explanation: 'V·ª• ƒë·∫Øm t√†u l√†m thi·ªát m·∫°ng 3 ng∆∞·ªùi.' },
                    { text: 'When did the storm __ the city?', answer: 'hit', explanation: 'Khi n√†o c∆°n b√£o ƒë·ªï b·ªô (hit) th√†nh ph·ªë?' },
                    { text: 'The tsunami __ the roads and buildings.', answer: 'destroyed', explanation: 'S√≥ng th·∫ßn ph√° h·ªßy (destroyed) ƒë∆∞·ªùng x√°.' },
                    { text: 'The wind __ hard before the storm.', answer: 'blew', explanation: 'Gi√≥ th·ªïi m·∫°nh (blew).' },
                    { text: 'The river __ after a week of heavy rain.', answer: 'overflowed', explanation: 'S√¥ng tr√†n b·ªù (overflowed).' }
                ]
            },
            {
                id: 'u2-word-forms',
                type: QuestionType.Fill,
                title: '6. Grammar: Word Forms',
                explanation: 'Ch·ªçn d·∫°ng t·ª´ ƒë√∫ng (Danh t·ª´/T√≠nh t·ª´/ƒê·ªông t·ª´) cho c√¢u.',
                options: ['destruction', 'injured', 'explosion', 'erupted', 'relieved', 'terrifying', 'worried'],
                questions: [
                    { text: 'The __ from the tsunami was terrible. (DESTROY)', answer: 'destruction', explanation: 'C·∫ßn danh t·ª´: Destruction (s·ª± ph√° h·ªßy).' },
                    { text: 'The police helped the __ people. (INJURE)', answer: 'injured', explanation: 'C·∫ßn t√≠nh t·ª´: Injured people (ng∆∞·ªùi b·ªã th∆∞∆°ng).' },
                    { text: 'They heard a loud __ from the building. (EXPLODE)', answer: 'explosion', explanation: 'C·∫ßn danh t·ª´: Explosion (v·ª• n·ªï).' },
                    { text: 'Mount Fuji last __ in 1707. (ERUPT)', answer: 'erupted', explanation: 'C·∫ßn ƒë·ªông t·ª´ qu√° kh·ª©: Erupted (phun tr√†o).' },
                    { text: 'She felt __ because no one was injured. (RELIEVE)', answer: 'relieved', explanation: 'C·∫£m th·∫•y nh·∫π nh√µm: Relieved.' },
                    { text: 'The news says a __ storm is coming. (TERRIFY)', answer: 'terrifying', explanation: 'M·ªôt c∆°n b√£o ƒë√°ng s·ª£: Terrifying.' },
                    { text: 'People are __ about their life. (WORRY)', answer: 'worried', explanation: 'Lo l·∫Øng: Worried.' }
                ]
            },
            {
                id: 'u2-past-story',
                type: QuestionType.Fill,
                title: '7. Grammar: Past Simple / Past Continuous Story',
                explanation: 'Ho√†n th√†nh c√¢u chuy·ªán ·ªü th√¨ qu√° kh·ª©.',
                options: ['started', 'were running', 'fell', 'opened', 'took'],
                questions: [
                    { text: 'David was running in the forest when it __ to rain.', answer: 'started', explanation: 'H√†nh ƒë·ªông c·∫Øt ngang (b·∫Øt ƒë·∫ßu m∆∞a) -> Qu√° kh·ª© ƒë∆°n.' },
                    { text: 'He and his dog __ to the car when the lightning struck.', answer: 'were running', explanation: 'H√†nh ƒë·ªông ƒëang di·ªÖn ra -> Qu√° kh·ª© ti·∫øp di·ªÖn.' },
                    { text: 'David __ to the ground.', answer: 'fell', explanation: 'H√†nh ƒë·ªông ng√£ xu·ªëng -> Qu√° kh·ª© ƒë∆°n.' },
                    { text: 'When he __ his eyes...', answer: 'opened', explanation: 'M·ªü m·∫Øt -> Qu√° kh·ª© ƒë∆°n.' },
                    { text: '...the emergency service __ him to the hospital.', answer: 'took', explanation: 'ƒê∆∞a ƒë·∫øn vi·ªán -> Qu√° kh·ª© ƒë∆°n.' }
                ]
            },
            {
                id: 'u2-pronun-1',
                type: QuestionType.MCQ,
                title: '8. Pronunciation: Odd one out',
                prompt: 'Ch·ªçn t·ª´ c√≥ ph·∫ßn g·∫°ch ch√¢n ph√°t √¢m kh√°c.',
                audioText: 'holiday, nothing, stop, volcanic',
                options: [
                    { text: 'A. h<u>o</u>liday', value: 'holiday' },
                    { text: 'B. n<u>o</u>thing', value: 'nothing' }, // / å/
                    { text: 'C. st<u>o</u>p', value: 'stop' },
                    { text: 'D. v<u>o</u>lcanic', value: 'volcanic' }
                ],
                answer: 'nothing',
                explanation: 'Nothing (/ å/) kh√°c v·ªõi c√°c t·ª´ c√≤n l·∫°i (/…í/).'
            },
            {
                id: 'u2-pronun-2',
                type: QuestionType.MCQ,
                title: '9. Pronunciation: Odd one out',
                prompt: 'Ch·ªçn t·ª´ c√≥ ph·∫ßn g·∫°ch ch√¢n ph√°t √¢m kh√°c.',
                audioText: 'warm, harm, farm, start',
                options: [
                    { text: 'A. w<u>a</u>rm', value: 'warm' }, // /…îÀê/
                    { text: 'B. h<u>a</u>rm', value: 'harm' }, // /…ëÀê/
                    { text: 'C. f<u>a</u>rm', value: 'farm' }, // /…ëÀê/
                    { text: 'D. st<u>a</u>rt', value: 'start' } // /…ëÀê/
                ],
                answer: 'warm',
                explanation: 'Warm (/…îÀê/) kh√°c v·ªõi c√°c t·ª´ c√≤n l·∫°i (/…ëÀê/).'
            },
            {
                id: 'u2-pronun-ed',
                type: QuestionType.MCQ,
                title: '10. Pronunciation: -ed endings',
                prompt: 'Ch·ªçn t·ª´ c√≥ ƒëu√¥i -ed ph√°t √¢m kh√°c.',
                audioText: 'climbed, destroyed, exploded, injured',
                options: [
                    { text: 'A. climb<u>ed</u>', value: 'climbed' }, // /d/
                    { text: 'B. destroy<u>ed</u>', value: 'destroyed' }, // /d/
                    { text: 'C. explod<u>ed</u>', value: 'exploded' }, // /id/
                    { text: 'D. injur<u>ed</u>', value: 'injured' } // /d/
                ],
                answer: 'exploded',
                explanation: 'Exploded (/…™d/) v√¨ k·∫øt th√∫c b·∫±ng /d/, c√°c t·ª´ c√≤n l·∫°i l√† /d/.'
            },
            {
                id: 'u2-pronun-ed-2',
                type: QuestionType.MCQ,
                title: '11. Pronunciation: -ed endings',
                prompt: 'Ch·ªçn t·ª´ c√≥ ƒëu√¥i -ed ph√°t √¢m kh√°c.',
                audioText: 'screamed, overflowed, cleaned, crashed',
                options: [
                    { text: 'A. scream<u>ed</u>', value: 'screamed' }, // /d/
                    { text: 'B. overflow<u>ed</u>', value: 'overflowed' }, // /d/
                    { text: 'C. clean<u>ed</u>', value: 'cleaned' }, // /d/
                    { text: 'D. crash<u>ed</u>', value: 'crashed' } // /t/
                ],
                answer: 'crashed',
                explanation: 'Crashed (/t/) v√¨ k·∫øt th√∫c b·∫±ng / É/, c√°c t·ª´ c√≤n l·∫°i l√† /d/.'
            },
            {
                id: 'u2-pronun-ed-3',
                type: QuestionType.MCQ,
                title: '12. Pronunciation: -ed endings',
                prompt: 'Ch·ªçn t·ª´ c√≥ ƒëu√¥i -ed ph√°t √¢m kh√°c.',
                audioText: 'walked, watched, stayed, washed',
                options: [
                    { text: 'A. walk<u>ed</u>', value: 'walked' }, // /t/
                    { text: 'B. watch<u>ed</u>', value: 'watched' }, // /t/
                    { text: 'C. stay<u>ed</u>', value: 'stayed' }, // /d/
                    { text: 'D. wash<u>ed</u>', value: 'washed' } // /t/
                ],
                answer: 'stayed',
                explanation: 'Stayed (/d/) v√¨ k·∫øt th√∫c b·∫±ng nguy√™n √¢m, c√°c t·ª´ c√≤n l·∫°i l√† /t/.'
            },
            {
                id: 'u2-listening',
                type: QuestionType.Fill,
                title: '13. Listening: Gap Fill',
                prompt: 'Nghe ƒëo·∫°n h·ªôi tho·∫°i v√† ƒëi·ªÅn v√†o ch·ªó tr·ªëng.',
                audioText: 'I was in the kitchen when I heard a loud noise. It was a plane crash nearby. I looked out and saw smoke and fire everywhere. Luckily, only the pilot got injured. I feel relieved now because I was safe inside.',
                explanation: 'Nghe k·ªπ c√°c t·ª´ kh√≥a v·ªÅ ƒë·ªãa ƒëi·ªÉm, s·ª± ki·ªán v√† c·∫£m x√∫c.',
                options: ['kitchen', 'plane crash', 'fire', 'The pilot', 'safe'],
                questions: [
                    { text: 'Jane heard a loud noise when she was in her __.', answer: 'kitchen', explanation: 'C√¥ ·∫•y ·ªü trong b·∫øp (kitchen).' },
                    { text: 'The accident was a __.', answer: 'plane crash', explanation: 'Tai n·∫°n r∆°i m√°y bay (plane crash).' },
                    { text: 'She saw smoke and __.', answer: 'fire', explanation: 'Kh√≥i v√† l·ª≠a (fire).' },
                    { text: '__ got injured.', answer: 'The pilot', explanation: 'Phi c√¥ng b·ªã th∆∞∆°ng.' },
                    { text: 'She feels relieved now because she was __.', answer: 'safe', explanation: 'C√¥ ·∫•y an to√†n (safe).' }
                ]
            },
            {
                id: 'u2-writing',
                type: QuestionType.Writing,
                title: '14. Writing',
                prompt: 'Vi·∫øt 3 c√¢u v·ªÅ m·ªôt tai n·∫°n/th·∫£m h·ªça. S·ª≠ d·ª•ng th√¨ Qu√° kh·ª© ƒë∆°n ho·∫∑c Qu√° kh·ª© ti·∫øp di·ªÖn.',
                explanation: 'G·ª£i √Ω: I was [doing something] when [disaster] happened.',
                prefix: 'Story:',
                placeholder: '1. I was sleeping when the earthquake happened.\n2. ...',
                correctAnswer: 'hint used'
            }
        ];

        const units = {
            'unit2': {
                id: 'unit2',
                title: 'Unit 2: Disasters & Accidents',
                icon: 'üåã',
                vocabulary: unit2Vocab,
                questions: unit2Questions
            },
            'unit3': {
                id: 'unit3',
                title: 'Unit 3: The Environment',
                icon: 'üåç',
                vocabulary: unit3Vocab,
                questions: unit3Questions
            }
        };

        // ==========================================
        // 4. COMPONENTS
        // ==========================================

        // --- MCQ Renderer ---
        const MCQRenderer = ({ question, userAnswer, isChecked, onAnswer }) => {
            const handlePlayAudio = () => playTTS(question.audioText || '');

            if (question.type === QuestionType.ListenWrite) {
                return (
                    <div className="flex flex-col items-center space-y-6">
                        <button onClick={handlePlayAudio} className="px-6 py-3 rounded-full font-bold text-white shadow-lg transform transition hover:scale-105 active:scale-95 flex items-center gap-2 bg-pink-500 hover:bg-pink-600">
                            üîä Listen
                        </button>
                        <div className="text-2xl font-mono bg-white px-4 py-2 rounded border border-gray-200 shadow-sm text-slate-600">
                            {question.display}
                        </div>
                        <div className="w-full max-w-md">
                            <input
                                type="text"
                                disabled={isChecked}
                                value={userAnswer || ''}
                                onChange={(e) => onAnswer(e.target.value)}
                                placeholder="Type the word here..."
                                className={`w-full text-center text-xl p-3 border-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-teal-500 transition-colors ${
                                    isChecked 
                                        ? (question.answer.toLowerCase() === (userAnswer || '').toLowerCase().trim() 
                                            ? 'border-green-500 bg-green-50 text-green-800' 
                                            : 'border-red-500 bg-red-50 text-red-800')
                                        : 'border-slate-200'
                                }`}
                            />
                        </div>
                    </div>
                );
            }

            return (
                <div className="space-y-4">
                    {question.audioText && (
                        <div className="flex justify-center mb-6">
                            <button onClick={handlePlayAudio} className="px-4 py-2 rounded-lg font-semibold text-white shadow transition flex items-center gap-2 bg-pink-500 hover:bg-pink-600">
                                üîä Play Audio
                            </button>
                        </div>
                    )}
                    {question.questionText && (
                        <div className="text-lg font-medium text-slate-700 bg-slate-100 p-4 rounded-lg">
                            {question.questionText}
                        </div>
                    )}
                    <div className="grid gap-3">
                        {question.options.map((opt) => {
                            const isSelected = userAnswer === opt.value;
                            const isCorrect = question.answer === opt.value;
                            let className = "relative p-4 rounded-xl border-2 cursor-pointer transition-all duration-200 flex items-center ";
                            
                            if (isChecked) {
                                if (isCorrect) className += "bg-green-100 border-green-500 text-green-900";
                                else if (isSelected) className += "bg-red-100 border-red-500 text-red-900";
                                else className += "bg-white border-slate-200 opacity-60";
                            } else {
                                if (isSelected) className += "bg-teal-50 border-teal-500 ring-1 ring-teal-500";
                                else className += "bg-white border-slate-200 hover:border-teal-300 hover:bg-slate-50";
                            }

                            return (
                                <div key={opt.value} onClick={() => !isChecked && onAnswer(opt.value)} className={className}>
                                    <span className="text-lg" dangerouslySetInnerHTML={{ __html: opt.text }} />
                                    {isChecked && isCorrect && <span className="absolute right-4 text-green-600 text-xl font-bold">‚úì</span>}
                                    {isChecked && isSelected && !isCorrect && <span className="absolute right-4 text-red-600 text-xl font-bold">‚úó</span>}
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        // --- Match Renderer ---
        const MatchRenderer = ({ question, userAnswer = {}, isChecked, onAnswer }) => {
            const [selectedA, setSelectedA] = useState(null);
            const [shuffledB, setShuffledB] = useState([]);

            useEffect(() => {
                setShuffledB(question.items.map(i => i.B).sort(() => Math.random() - 0.5));
            }, [question]);

            const handleSelectA = (a) => {
                if (isChecked) return;
                if (selectedA === a) setSelectedA(null);
                else if (userAnswer[a]) {
                    const next = { ...userAnswer };
                    delete next[a];
                    onAnswer(next);
                    setSelectedA(a);
                } else {
                    setSelectedA(a);
                }
            };

            const handleSelectB = (b) => {
                if (isChecked || !selectedA) return;
                const next = { ...userAnswer };
                Object.keys(next).forEach(key => {
                    if (next[key] === b) delete next[key];
                });
                next[selectedA] = b;
                onAnswer(next);
                setSelectedA(null);
            };

            return (
                <div className="grid grid-cols-2 gap-4 md:gap-8 select-none">
                    <div className="space-y-3">
                        <h3 className="font-bold text-center text-teal-700 mb-2">English</h3>
                        {question.items.map(item => {
                            const isPaired = !!userAnswer[item.A];
                            const isSelected = selectedA === item.A;
                            const matchedB = userAnswer[item.A];
                            const isCorrect = isChecked && matchedB === item.B;
                            const isWrong = isChecked && matchedB && matchedB !== item.B;

                            let bgClass = "bg-white border-slate-200";
                            if (isChecked) {
                                if (isCorrect) bgClass = "bg-green-100 border-green-500 text-green-900";
                                else if (isWrong) bgClass = "bg-red-100 border-red-500 text-red-900";
                            } else {
                                if (isSelected) bgClass = "bg-yellow-100 border-yellow-500 ring-2 ring-yellow-300";
                                else if (isPaired) bgClass = "bg-blue-50 border-blue-400";
                            }

                            return (
                                <div key={item.A} onClick={() => handleSelectA(item.A)} className={`p-3 md:p-4 rounded-lg border-2 shadow-sm cursor-pointer transition-all ${bgClass}`}>
                                    <span className="font-semibold">{item.A}</span>
                                    {isPaired && !isChecked && <div className="text-xs text-blue-600 mt-1 truncate">‚Üí {matchedB}</div>}
                                </div>
                            );
                        })}
                    </div>
                    <div className="space-y-3">
                        <h3 className="font-bold text-center text-teal-700 mb-2">Vietnamese</h3>
                        {shuffledB.map((text) => {
                            const parentA = Object.keys(userAnswer).find(key => userAnswer[key] === text);
                            const isUsed = !!parentA;
                            let bgClass = "bg-white border-slate-200 hover:bg-slate-50";
                            if (isChecked) {
                                const correctAObj = question.items.find(i => i.B === text);
                                const userPairCorrect = correctAObj && userAnswer[correctAObj.A] === text;
                                if (userPairCorrect) bgClass = "bg-green-100 border-green-500";
                                else if (isUsed) bgClass = "bg-red-100 border-red-500";
                            } else {
                                if (isUsed) bgClass = "bg-slate-100 border-slate-300 text-slate-500";
                                if (selectedA && !isUsed) bgClass = "bg-white border-teal-300 hover:bg-teal-50 cursor-pointer animate-pulse";
                            }
                            return (
                                <div key={text} onClick={() => handleSelectB(text)} className={`p-3 md:p-4 rounded-lg border-2 shadow-sm transition-all ${bgClass} ${!selectedA && !isChecked ? 'cursor-default' : 'cursor-pointer'}`}>
                                    {text}
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        // --- Fill Blank Renderer ---
        const FillBlankRenderer = ({ question, userAnswer = {}, isChecked, onAnswer }) => {
            const [activeSlot, setActiveSlot] = useState(null);

            const handleWordSelect = (word) => {
                if (activeSlot === null || isChecked) return;
                const next = { ...userAnswer };
                Object.keys(next).forEach(key => {
                    if (next[Number(key)] === word) delete next[Number(key)];
                });
                next[activeSlot] = word;
                onAnswer(next);
                setActiveSlot(null);
            };

            const usedWords = Object.values(userAnswer);

            return (
                <div className="space-y-6">
                    <div className="bg-slate-100 p-4 rounded-xl border border-slate-200">
                        <h4 className="text-sm font-bold text-slate-500 uppercase tracking-wide mb-3">Word Bank</h4>
                        <div className="flex flex-wrap gap-2">
                            {question.options.map(opt => {
                                const isUsed = usedWords.includes(opt);
                                return (
                                    <button
                                        key={opt}
                                        disabled={isChecked || activeSlot === null}
                                        onClick={() => handleWordSelect(opt)}
                                        className={`px-3 py-1.5 rounded-lg text-sm font-medium transition-all transform
                                            ${isChecked 
                                                ? 'bg-slate-200 text-slate-500 cursor-default' 
                                                : activeSlot !== null
                                                    ? isUsed 
                                                        ? 'bg-slate-200 text-slate-400 scale-95'
                                                        : 'bg-teal-600 text-white shadow-md hover:scale-105 hover:bg-teal-700'
                                                    : 'bg-slate-300 text-slate-600 cursor-not-allowed'
                                            }
                                        `}
                                    >
                                        {opt}
                                    </button>
                                );
                            })}
                        </div>
                    </div>
                    <div className="space-y-3">
                        {question.questions.map((q, idx) => {
                            const currentVal = userAnswer[idx];
                            const isCorrect = isChecked && currentVal === q.answer;
                            const parts = q.text.split('__');
                            return (
                                <div key={idx} className={`p-3 rounded-lg border flex items-start gap-3 ${isChecked ? (isCorrect ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200') : 'bg-white border-slate-200'}`}>
                                    <span className="font-mono text-slate-400 mt-1">{idx + 1}.</span>
                                    <div className="leading-loose text-lg text-slate-800">
                                        {parts[0]}
                                        <span
                                            onClick={() => !isChecked && setActiveSlot(idx)}
                                            className={`inline-block min-w-[80px] px-2 py-0.5 mx-1 border-b-2 text-center cursor-pointer font-bold transition-colors
                                                ${isChecked
                                                    ? isCorrect 
                                                        ? 'border-green-500 text-green-700' 
                                                        : 'border-red-500 text-red-700'
                                                    : activeSlot === idx 
                                                        ? 'border-teal-500 bg-teal-50 text-teal-800' 
                                                        : 'border-slate-400 bg-slate-50 hover:bg-slate-100'
                                                }
                                            `}
                                        >
                                            {currentVal || '____'}
                                        </span>
                                        {parts[1]}
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        // --- Text Entry Renderer ---
        const TextEntryRenderer = ({ question, userAnswer = '', isChecked, onAnswer }) => {
            if (question.type === QuestionType.Writing) {
                return (
                    <div className="space-y-4">
                        <textarea
                            disabled={isChecked}
                            value={userAnswer}
                            onChange={(e) => onAnswer(e.target.value)}
                            rows={6}
                            placeholder={question.placeholder}
                            className={`w-full p-4 rounded-xl border-2 focus:ring-2 focus:ring-teal-500 outline-none transition-colors ${isChecked ? 'bg-slate-50 border-slate-300 text-slate-600' : 'bg-white border-slate-200 hover:border-teal-300'}`}
                        />
                        <p className="text-sm text-slate-500 italic">Structure suggestion: If + S + V (present), S + will + V (base form)...</p>
                    </div>
                );
            }
            return (
                <div className="bg-slate-100 p-6 rounded-xl border border-slate-200">
                    <h3 className="text-xl font-medium text-slate-800 mb-4">{question.prefix}</h3>
                    <input
                        type="text"
                        disabled={isChecked}
                        value={userAnswer}
                        onChange={(e) => onAnswer(e.target.value)}
                        placeholder={question.placeholder}
                        className={`w-full p-3 text-lg rounded-lg border-2 focus:ring-2 focus:ring-teal-500 outline-none ${
                            isChecked
                                ? userAnswer.toLowerCase().includes(question.correctAnswer.toLowerCase()) 
                                    ? 'bg-green-50 border-green-500 text-green-900' 
                                    : 'bg-red-50 border-red-500 text-red-900'
                                : 'bg-white border-slate-300'
                        }`}
                    />
                </div>
            );
        };

        // --- Sentence Scramble Renderer ---
        const SentenceScrambleRenderer = ({ question, userAnswer, isChecked, onAnswer }) => {
            const [pool, setPool] = useState([]);

            useEffect(() => {
                if (!userAnswer || userAnswer.length === 0) {
                    setPool([...question.segments].sort(() => Math.random() - 0.5));
                } else {
                    const currentUsed = [...userAnswer];
                    const remaining = [...question.segments];
                    currentUsed.forEach(word => {
                        const idx = remaining.indexOf(word);
                        if (idx > -1) remaining.splice(idx, 1);
                    });
                    setPool(remaining);
                }
            }, [question.id, userAnswer]);

            const handlePlayAudio = () => playTTS(question.audioText || '');

            const moveToAnswer = (word, index) => {
                if (isChecked) return;
                const newPool = [...pool];
                newPool.splice(index, 1);
                setPool(newPool);
                const newAnswer = userAnswer ? [...userAnswer, word] : [word];
                onAnswer(newAnswer);
            };

            const returnToPool = (word, index) => {
                if (isChecked) return;
                const newAnswer = [...userAnswer];
                newAnswer.splice(index, 1);
                onAnswer(newAnswer);
                setPool(prev => [...prev, word]);
            };

            return (
                <div className="flex flex-col items-center space-y-8">
                    <button onClick={handlePlayAudio} className="px-6 py-3 bg-pink-500 hover:bg-pink-600 text-white rounded-full font-bold shadow-md transform hover:scale-105 transition flex items-center gap-2">
                        üîä Nghe c√¢u m·∫´u
                    </button>
                    <div className="w-full min-h-[80px] p-4 bg-slate-100 rounded-xl border-2 border-dashed border-slate-300 flex flex-wrap gap-2 justify-center items-center relative">
                        {!userAnswer?.length && <span className="text-slate-400 absolute select-none pointer-events-none">B·∫•m v√†o c√°c t·ª´ b√™n d∆∞·ªõi ƒë·ªÉ s·∫Øp x·∫øp...</span>}
                        {userAnswer?.map((word, idx) => (
                            <button key={`${word}-${idx}`} onClick={() => returnToPool(word, idx)} disabled={isChecked} className={`px-4 py-2 bg-white border-2 border-teal-500 text-teal-800 rounded-lg shadow-sm font-medium hover:bg-red-50 hover:border-red-400 transition transform active:scale-95 ${isChecked ? 'cursor-default' : 'cursor-pointer'}`}>
                                {word}
                            </button>
                        ))}
                    </div>
                    <div className="flex flex-wrap gap-3 justify-center">
                        {pool.map((word, idx) => (
                            <button key={`${word}-${idx}`} onClick={() => moveToAnswer(word, idx)} disabled={isChecked} className={`px-4 py-2 bg-slate-200 text-slate-700 rounded-lg shadow font-medium hover:bg-teal-100 hover:text-teal-800 transition transform active:scale-95 ${isChecked ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}`}>
                                {word}
                            </button>
                        ))}
                    </div>
                    {isChecked && (
                        <div className="text-center mt-2 animate-fadeIn">
                            <p className="text-slate-500 text-sm">Th·ª© t·ª± ƒë√∫ng:</p>
                            <p className="font-bold text-teal-700 text-lg">{question.correctOrder.join(' ')}</p>
                        </div>
                    )}
                </div>
            );
        };

        // --- Question Renderer Dispatcher ---
        const QuestionRenderer = (props) => {
            switch (props.question.type) {
                case QuestionType.Match: return <MatchRenderer {...props} />;
                case QuestionType.Fill: return <FillBlankRenderer {...props} />;
                case QuestionType.MCQ:
                case QuestionType.Listening:
                case QuestionType.ListenWrite: return <MCQRenderer {...props} />;
                case QuestionType.ShortAnswer:
                case QuestionType.Writing: return <TextEntryRenderer {...props} />;
                case QuestionType.SentenceScramble: return <SentenceScrambleRenderer {...props} />;
                default: return <div>Unknown Question Type</div>;
            }
        };

        // --- Quiz Navigation ---
        const QuizNavigation = ({ isChecked, hasPrev, hasNext, onPrev, onNext, onCheck, onHint }) => (
            <div className="mt-8 pt-6 border-t border-slate-100 flex flex-col sm:flex-row justify-between items-center gap-4">
                <button onClick={onHint} disabled={isChecked} className="order-3 sm:order-1 text-sm font-semibold text-orange-500 hover:text-orange-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1 px-4 py-2 hover:bg-orange-50 rounded-lg transition">
                    üí° G·ª£i √Ω (-1 ƒêi·ªÉm)
                </button>
                <div className="order-1 sm:order-2 flex gap-3 w-full sm:w-auto">
                    <button onClick={onPrev} disabled={!hasPrev} className="flex-1 sm:flex-none px-6 py-3 bg-slate-100 text-slate-700 font-semibold rounded-xl hover:bg-slate-200 disabled:opacity-50 disabled:cursor-not-allowed transition">
                        ‚Üê Quay l·∫°i
                    </button>
                    {!isChecked ? (
                        <button onClick={onCheck} className="flex-1 sm:flex-none px-8 py-3 bg-teal-600 text-white font-bold rounded-xl shadow-md hover:bg-teal-700 hover:shadow-lg transform active:scale-95 transition">
                            Ki·ªÉm tra
                        </button>
                    ) : (
                        <button onClick={onNext} className="flex-1 sm:flex-none px-8 py-3 bg-blue-600 text-white font-bold rounded-xl shadow-md hover:bg-blue-700 hover:shadow-lg transform active:scale-95 transition flex items-center justify-center gap-2">
                            {hasNext ? 'C√¢u ti·∫øp theo ‚Üí' : 'Xem k·∫øt qu·∫£ üèÜ'}
                        </button>
                    )}
                </div>
            </div>
        );

        // --- Sidebar ---
        const QuestionListSidebar = ({ totalQuestions, currentIndex, answers, onSelectQuestion }) => (
            <div className="bg-white rounded-2xl shadow-lg p-4 h-fit sticky top-4 border border-slate-100">
                <h3 className="font-bold text-slate-700 mb-4 text-center border-b pb-2">Danh s√°ch c√¢u h·ªèi</h3>
                <div className="grid grid-cols-5 md:grid-cols-3 lg:grid-cols-4 gap-2">
                    {Array.from({ length: totalQuestions }).map((_, idx) => {
                        const status = answers[idx];
                        let btnClass = "w-full aspect-square flex items-center justify-center rounded-lg font-semibold text-sm transition-all duration-200 ";
                        if (currentIndex === idx) btnClass += "bg-teal-600 text-white ring-2 ring-teal-300 ring-offset-1 scale-105 shadow-md";
                        else if (status?.isChecked) {
                            if (status.isCorrect) btnClass += "bg-green-100 text-green-700 border border-green-300 hover:bg-green-200";
                            else btnClass += "bg-red-100 text-red-700 border border-red-300 hover:bg-red-200";
                        } else if (status?.value) btnClass += "bg-blue-50 text-blue-600 border border-blue-200 hover:bg-blue-100";
                        else btnClass += "bg-slate-100 text-slate-500 hover:bg-slate-200";
                        return <button key={idx} onClick={() => onSelectQuestion(idx)} className={btnClass}>{idx + 1}</button>;
                    })}
                </div>
            </div>
        );

        // --- Start Screen ---
        const StartScreen = ({ onStart, unitTitle, unitIcon }) => {
            const [name, setName] = useState('');
            const handleSubmit = (e) => {
                e.preventDefault();
                if (name.trim().length >= 2) onStart(name.trim());
            };
            return (
                <div className="flex flex-col items-center justify-center min-h-[60vh] text-center px-4">
                    <div className="bg-white p-10 rounded-3xl shadow-2xl max-w-lg w-full transform transition hover:scale-105 duration-300 relative z-20">
                        <div className="text-6xl mb-6 animate-bounce">{unitIcon}</div>
                        <h1 className="text-3xl md:text-4xl font-extrabold text-teal-800 mb-4 transition-all duration-300 min-h-[80px] flex items-center justify-center">
                            {unitTitle}
                        </h1>
                        <p className="text-slate-500 mb-8 text-lg">Ki·ªÉm tra t·ª´ v·ª±ng, nghe v√† ng·ªØ ph√°p c·ªßa b·∫°n.</p>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <input type="text" value={name} onChange={(e) => setName(e.target.value)} placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n..." className="w-full px-5 py-4 rounded-xl border-2 border-slate-200 bg-slate-50 text-lg focus:ring-4 focus:ring-teal-100 focus:border-teal-500 outline-none transition" autoFocus />
                            <button type="submit" disabled={name.trim().length < 2} className="w-full py-4 bg-teal-600 text-white font-bold text-lg rounded-xl shadow-lg hover:bg-teal-700 disabled:opacity-50 disabled:cursor-not-allowed transition">B·∫Øt ƒë·∫ßu l√†m b√†i</button>
                        </form>
                    </div>
                </div>
            );
        };

        // --- Vocabulary Study ---
        const VocabularyStudy = ({ vocabList, onFinish }) => (
            <div className="max-w-4xl mx-auto bg-white rounded-3xl shadow-xl overflow-hidden animate-fadeIn">
                <div className="bg-teal-600 p-6 text-center">
                    <h2 className="text-3xl font-bold text-white mb-2">H·ªçc T·ª´ V·ª±ng üìñ</h2>
                    <p className="text-teal-100">Nghe v√† ƒë·ªçc to c√°c t·ª´ v·ª±ng tr∆∞·ªõc khi l√†m b√†i t·∫≠p.</p>
                </div>
                <div className="p-6 md:p-8">
                    <div className="overflow-x-auto">
                        <table className="w-full text-left border-collapse">
                            <thead>
                                <tr className="border-b-2 border-slate-200 text-slate-500 text-sm uppercase tracking-wider">
                                    <th className="py-3 px-4">Nghe</th>
                                    <th className="py-3 px-4">T·ª´ v·ª±ng</th>
                                    <th className="py-3 px-4">Phi√™n √¢m</th>
                                    <th className="py-3 px-4">Nghƒ©a ti·∫øng Vi·ªát</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-slate-100">
                                {vocabList.map((item, idx) => (
                                    <tr key={idx} className="hover:bg-slate-50 transition-colors">
                                        <td className="py-3 px-4">
                                            <button onClick={() => playTTS(item.word)} className="w-10 h-10 rounded-full bg-pink-100 text-pink-600 flex items-center justify-center hover:bg-pink-200 transition shadow-sm">üîä</button>
                                        </td>
                                        <td className="py-3 px-4 text-lg font-bold text-slate-800">{item.word}</td>
                                        <td className="py-3 px-4 font-mono text-slate-500">{item.ipa}</td>
                                        <td className="py-3 px-4 text-slate-700">{item.meaning}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                    <div className="mt-8 text-center">
                        <button onClick={onFinish} className="px-10 py-4 bg-teal-600 text-white font-bold rounded-xl shadow-lg hover:bg-teal-700 hover:shadow-xl transform transition hover:-translate-y-1 active:scale-95 text-lg">ƒê√£ h·ªçc xong - B·∫Øt ƒë·∫ßu l√†m b√†i t·∫≠p ‚ûî</button>
                    </div>
                </div>
            </div>
        );

        // --- Result Screen ---
        const ResultScreen = ({ playerName, answers, totalQuestions, onRestart }) => {
            let correct = 0;
            let hintsPenalty = 0;
            Object.values(answers).forEach((ans) => {
                if (ans.isCorrect) correct++;
                if (ans.isHintUsed) hintsPenalty++;
            });
            const finalScore = Math.max(0, correct - hintsPenalty);

            return (
                <div className="flex flex-col items-center justify-center min-h-[60vh] px-4 animate-fadeIn">
                    <div className="bg-white p-8 md:p-12 rounded-3xl shadow-xl max-w-2xl w-full text-center">
                        <h2 className="text-3xl font-bold text-slate-800 mb-2">Great Job, {playerName}! üéâ</h2>
                        <p className="text-slate-500 mb-8">You have completed the Quiz.</p>
                        <div className="flex justify-center mb-8">
                            <div className="relative w-40 h-40 flex items-center justify-center rounded-full border-8 border-teal-100 bg-teal-50">
                                <div className="text-center">
                                    <span className="block text-4xl font-black text-teal-700">{finalScore}</span>
                                    <span className="text-sm text-teal-600 font-bold uppercase">Points</span>
                                </div>
                            </div>
                        </div>
                        <div className="grid grid-cols-2 gap-4 mb-8 max-w-xs mx-auto">
                            <div className="bg-green-50 p-4 rounded-xl">
                                <div className="text-2xl font-bold text-green-700">{correct}</div>
                                <div className="text-xs text-green-600 font-semibold">Correct</div>
                            </div>
                            <div className="bg-red-50 p-4 rounded-xl">
                                <div className="text-2xl font-bold text-red-700">{totalQuestions - correct}</div>
                                <div className="text-xs text-red-600 font-semibold">Wrong</div>
                            </div>
                        </div>
                        {hintsPenalty > 0 && (
                            <p className="text-sm text-orange-500 mb-6 bg-orange-50 inline-block px-4 py-2 rounded-lg">‚ö†Ô∏è {hintsPenalty} points deducted for hints.</p>
                        )}
                        <button onClick={onRestart} className="px-10 py-4 bg-slate-800 text-white font-bold rounded-xl shadow-lg hover:bg-slate-700 hover:shadow-xl transform transition active:scale-95">Try Again ‚Ü∫</button>
                    </div>
                </div>
            );
        };

        // ==========================================
        // 5. MAIN APP
        // ==========================================
        const App = () => {
            const [gameState, setGameState] = useState('START'); // START, STUDY, PLAYING, RESULT
            const [currentUnitId, setCurrentUnitId] = useState('unit2');
            const [playerName, setPlayerName] = useState('');
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
            const [answers, setAnswers] = useState({});
            const [showUnitSelection, setShowUnitSelection] = useState(false);
            const [voices, setVoices] = useState([]);
            const [currentVoiceName, setCurrentVoiceName] = useState('');

            const currentUnit = units[currentUnitId] || units['unit2'];
            const quizData = currentUnit.questions;
            const vocabularyList = currentUnit.vocabulary;
            const currentQuestion = quizData[currentQuestionIndex];
            const currentAnswerState = answers[currentQuestionIndex];
            const userAnswerValue = currentAnswerState?.value;
            const isChecked = currentAnswerState?.isChecked || false;

            useEffect(() => {
                const loadVoices = () => {
                    const available = getAvailableVoices();
                    setVoices(available);
                    if (available.length > 0) {
                        const defaultVoice = available.find(v => v.name === 'Google US English') || available[0];
                        setCurrentVoiceName(defaultVoice.name);
                        setPreferredVoice(defaultVoice.name);
                    }
                };
                loadVoices();
                if (window.speechSynthesis.onvoiceschanged !== undefined) {
                    window.speechSynthesis.onvoiceschanged = loadVoices;
                }
            }, []);

            const handleVoiceChange = (e) => {
                const name = e.target.value;
                setCurrentVoiceName(name);
                setPreferredVoice(name);
                playTTS("Hello");
            };

            const handleStart = (name) => {
                setPlayerName(name);
                setGameState('STUDY');
                setCurrentQuestionIndex(0);
                setAnswers({});
            };

            const handleFinishStudy = () => setGameState('PLAYING');
            
            const handleRestart = () => {
                setGameState('START');
                setPlayerName('');
                setAnswers({});
            };

            const handleUnitChange = (unitId) => {
                if (unitId === currentUnitId) {
                    setShowUnitSelection(false);
                    return;
                }
                if (gameState !== 'START') {
                    if (!window.confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën ƒë·ªïi sang b√†i "${units[unitId].title}"? Ti·∫øn ƒë·ªô hi·ªán t·∫°i s·∫Ω b·ªã m·∫•t.`)) return;
                }
                setCurrentUnitId(unitId);
                setCurrentQuestionIndex(0);
                setAnswers({});
                setShowUnitSelection(false);
                if (gameState !== 'START') setGameState('STUDY');
            };

            const handleAnswerUpdate = (val) => {
                setAnswers(prev => ({
                    ...prev,
                    [currentQuestionIndex]: {
                        value: val,
                        isCorrect: false,
                        isChecked: false,
                        isHintUsed: prev[currentQuestionIndex]?.isHintUsed || false
                    }
                }));
            };

            const handleCheck = () => {
                if (!answers[currentQuestionIndex]?.value && currentQuestion.type !== QuestionType.SentenceScramble) return;
                const val = answers[currentQuestionIndex]?.value;
                if (currentQuestion.type === QuestionType.SentenceScramble && (!val || val.length === 0)) return;

                let isCorrect = false;
                switch (currentQuestion.type) {
                    case QuestionType.Match:
                        const correctCount = currentQuestion.items.reduce((acc, item) => acc + (val[item.A] === item.B ? 1 : 0), 0);
                        isCorrect = correctCount === currentQuestion.items.length;
                        break;
                    case QuestionType.Fill:
                        const filledCorrectly = currentQuestion.questions.every((q, idx) => val[idx] === q.answer);
                        const allFilled = Object.keys(val).length === currentQuestion.questions.length;
                        isCorrect = filledCorrectly && allFilled;
                        break;
                    case QuestionType.ShortAnswer:
                    case QuestionType.ListenWrite:
                        isCorrect = val.toLowerCase().trim().includes(currentQuestion.type === QuestionType.ListenWrite ? currentQuestion.answer.toLowerCase() : currentQuestion.correctAnswer.toLowerCase());
                        break;
                    case QuestionType.Writing:
                        isCorrect = val.split(' ').length > 5;
                        break;
                    case QuestionType.MCQ:
                    case QuestionType.Listening:
                        isCorrect = val === currentQuestion.answer;
                        break;
                    case QuestionType.SentenceScramble:
                        if (val.length !== currentQuestion.correctOrder.length) isCorrect = false;
                        else isCorrect = val.every((word, index) => word === currentQuestion.correctOrder[index]);
                        break;
                }

                setAnswers(prev => ({
                    ...prev,
                    [currentQuestionIndex]: { ...prev[currentQuestionIndex], isChecked: true, isCorrect }
                }));

                if (isCorrect && currentQuestion.type === QuestionType.SentenceScramble && currentQuestion.audioText) {
                    setTimeout(() => playTTS(currentQuestion.audioText), 500);
                }
            };

            const handleNext = () => {
                if (currentQuestionIndex < quizData.length - 1) setCurrentQuestionIndex(prev => prev + 1);
                else setGameState('RESULT');
            };

            const handleHint = () => {
                if (!window.confirm("D√πng g·ª£i √Ω s·∫Ω b·ªã tr·ª´ 1 ƒëi·ªÉm. B·∫°n ch·∫Øc ch·∫Øn ch·ª©?")) return;
                let solvedValue = null;
                switch (currentQuestion.type) {
                    case QuestionType.MCQ:
                    case QuestionType.Listening:
                    case QuestionType.ListenWrite:
                        solvedValue = currentQuestion.answer;
                        break;
                    case QuestionType.ShortAnswer:
                        solvedValue = currentQuestion.correctAnswer;
                        break;
                    case QuestionType.Match:
                        const matchSolved = {};
                        currentQuestion.items.forEach(i => matchSolved[i.A] = i.B);
                        solvedValue = matchSolved;
                        break;
                    case QuestionType.Fill:
                        const fillSolved = {};
                        currentQuestion.questions.forEach((q, i) => fillSolved[i] = q.answer);
                        solvedValue = fillSolved;
                        break;
                    case QuestionType.SentenceScramble:
                        solvedValue = currentQuestion.correctOrder;
                        break;
                    case QuestionType.Writing:
                        solvedValue = "Hint used.";
                        break;
                }
                setAnswers(prev => ({
                    ...prev,
                    [currentQuestionIndex]: { value: solvedValue, isChecked: true, isCorrect: true, isHintUsed: true }
                }));
            };

            // Views
            const UnitSelectionModal = () => (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fadeIn">
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden">
                        <div className="bg-gradient-to-r from-teal-600 to-blue-600 p-5 flex justify-between items-center">
                            <h3 className="text-white font-bold text-xl">üìö Ch·ªçn B√†i H·ªçc</h3>
                            <button onClick={() => setShowUnitSelection(false)} className="text-teal-100 hover:text-white text-3xl">&times;</button>
                        </div>
                        <div className="p-4 grid gap-3 max-h-[70vh] overflow-y-auto bg-slate-50">
                            {Object.values(units).map(u => (
                                <button key={u.id} onClick={() => handleUnitChange(u.id)} className={`flex items-center gap-4 p-4 rounded-xl border-2 text-left group transition-all ${currentUnitId === u.id ? 'border-teal-500 bg-white shadow-md ring-2 ring-teal-200' : 'border-slate-200 bg-white hover:border-teal-300'}`}>
                                    <div className="text-3xl p-3 rounded-lg bg-slate-50">{u.icon}</div>
                                    <div className="flex-1">
                                        <div className="font-bold text-lg text-slate-800">{u.title}</div>
                                        <div className="text-sm text-slate-500 mt-1">{u.questions.length} c√¢u h·ªèi ‚Ä¢ {u.vocabulary.length} t·ª´ v·ª±ng</div>
                                    </div>
                                    {currentUnitId === u.id && <div className="text-teal-500 font-bold text-xl">‚úì</div>}
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );

            if (gameState === 'START') {
                return (
                    <div className="flex flex-col items-center justify-center min-h-screen bg-slate-50 p-4 relative overflow-hidden">
                        <div className="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none opacity-40">
                            <div className="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-teal-200 rounded-full blur-[100px] animate-pulse"></div>
                            <div className="absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] bg-blue-200 rounded-full blur-[100px] animate-pulse" style={{animationDelay: '1s'}}></div>
                        </div>
                        <div className="w-full max-w-lg mb-8 text-center z-10">
                            <label className="block text-slate-500 font-bold mb-4 uppercase text-sm tracking-widest">Ch·ªçn b√†i h·ªçc ƒë·ªÉ b·∫Øt ƒë·∫ßu</label>
                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                {Object.values(units).map(u => (
                                    <button key={u.id} onClick={() => setCurrentUnitId(u.id)} className={`p-5 rounded-2xl border-2 flex flex-col items-center gap-3 transition-all ${currentUnitId === u.id ? 'border-teal-500 bg-white shadow-xl ring-4 ring-teal-100 scale-105' : 'border-slate-200 bg-white/80 hover:bg-white'}`}>
                                        <span className="text-5xl">{u.icon}</span>
                                        <span className="font-bold text-sm text-slate-700">{u.title}</span>
                                    </button>
                                ))}
                            </div>
                        </div>
                        <StartScreen onStart={handleStart} unitTitle={currentUnit.title} unitIcon={currentUnit.icon} />
                    </div>
                );
            }

            if (gameState === 'RESULT') return <ResultScreen playerName={playerName} answers={answers} totalQuestions={quizData.length} onRestart={handleRestart} />;

            return (
                <div className="min-h-screen py-4 px-4 md:px-8 max-w-7xl mx-auto">
                    {showUnitSelection && <UnitSelectionModal />}
                    <header className="flex flex-col md:flex-row justify-between items-center mb-6 gap-4 border-b pb-4 bg-slate-50/50 backdrop-blur-sm sticky top-0 z-20 md:relative">
                        <div className="flex flex-col items-start w-full md:w-auto">
                            <h1 className="text-xl md:text-2xl font-bold text-teal-800 flex items-center gap-2">
                                <span className="text-3xl">{currentUnit.icon}</span> 
                                <span className="truncate">{currentUnit.title}</span>
                            </h1>
                            <button onClick={() => setShowUnitSelection(true)} className="text-xs font-bold text-slate-600 bg-white border border-slate-300 px-3 py-1.5 rounded-lg mt-2 hover:bg-slate-50 hover:text-teal-600 transition flex items-center gap-2 shadow-sm">
                                üîÑ ƒê·ªïi b√†i h·ªçc kh√°c
                            </button>
                        </div>
                        <div className="flex items-center gap-3 w-full md:w-auto justify-end">
                            {gameState !== 'STUDY' && (
                                <button onClick={() => setGameState('STUDY')} className="text-sm font-bold text-teal-700 bg-teal-50 px-3 py-2 rounded-lg border border-teal-200 hover:bg-teal-100 transition shadow-sm flex items-center gap-1">
                                    üìñ <span className="hidden sm:inline">T·ª´ v·ª±ng</span>
                                </button>
                            )}
                            {voices.length > 0 && (
                                <div className="flex items-center gap-2 bg-white border border-slate-200 rounded-lg px-2 py-1 shadow-sm">
                                    <select id="voice-select" value={currentVoiceName} onChange={handleVoiceChange} className="text-sm text-slate-700 bg-transparent outline-none max-w-[100px] sm:max-w-[150px] truncate cursor-pointer">
                                        {voices.map(v => <option key={v.name} value={v.name}>{v.name.replace('Google', '').replace('English', '')}</option>)}
                                    </select>
                                </div>
                            )}
                            <div className="text-sm font-bold text-slate-600 bg-slate-200 px-3 py-2 rounded-full flex items-center gap-1">üë§ {playerName}</div>
                        </div>
                    </header>

                    {gameState === 'STUDY' ? (
                        <VocabularyStudy vocabList={vocabularyList} onFinish={handleFinishStudy} />
                    ) : (
                        <div className="grid grid-cols-1 md:grid-cols-12 gap-6 items-start">
                            <main className="md:col-span-9 bg-white rounded-3xl shadow-xl p-6 md:p-10 min-h-[500px] flex flex-col justify-between transition-all relative">
                                <div>
                                    <div className="flex justify-between items-start mb-6">
                                        <div>
                                            <span className="text-xs font-bold text-teal-600 uppercase tracking-wider bg-teal-50 px-2 py-1 rounded">C√¢u h·ªèi {currentQuestionIndex + 1} / {quizData.length}</span>
                                            <h2 className="text-xl md:text-2xl font-bold text-slate-800 mt-2">{currentQuestion.title}</h2>
                                        </div>
                                    </div>
                                    {currentQuestion.prompt && <p className="text-slate-600 mb-6 italic border-l-4 border-teal-500 pl-4 bg-slate-50 p-2 rounded-r">{currentQuestion.prompt}</p>}
                                    <QuestionRenderer question={currentQuestion} userAnswer={userAnswerValue} isChecked={isChecked} onAnswer={handleAnswerUpdate} />
                                    {isChecked && (
                                        <div className={`mt-6 p-4 rounded-xl border-l-4 ${currentAnswerState?.isHintUsed ? 'bg-yellow-50 border-yellow-500 text-yellow-900' : (currentAnswerState?.isCorrect ? 'bg-green-50 border-green-500 text-green-900' : 'bg-red-50 border-red-500 text-red-900')} animate-fadeIn`}>
                                            <h3 className="font-bold mb-1">{currentAnswerState?.isHintUsed ? 'ƒê√£ d√πng g·ª£i √Ω üí°' : (currentAnswerState?.isCorrect ? 'Ch√≠nh x√°c! üéâ' : 'Ch∆∞a ch√≠nh x√°c üòî')}</h3>
                                            <p dangerouslySetInnerHTML={{ __html: currentQuestion.explanation }} />
                                        </div>
                                    )}
                                </div>
                                <QuizNavigation currentIndex={currentQuestionIndex} totalQuestions={quizData.length} isChecked={isChecked} hasPrev={currentQuestionIndex > 0} hasNext={currentQuestionIndex < quizData.length - 1 || isChecked} onPrev={() => setCurrentQuestionIndex(p => p - 1)} onNext={handleNext} onCheck={handleCheck} onHint={handleHint} />
                            </main>
                            <aside className="md:col-span-3 order-first md:order-last w-full sticky top-20">
                                <QuestionListSidebar totalQuestions={quizData.length} currentIndex={currentQuestionIndex} answers={answers} onSelectQuestion={setCurrentQuestionIndex} />
                            </aside>
                        </div>
                    )}
                </div>
            );
        };

        // ==========================================
        // 6. RENDER
        // ==========================================
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
